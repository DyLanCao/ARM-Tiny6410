Linux Device Drivers
======

参考教材: <Linux Device Drivers, Third Edition>

机制和策略的区分是其中一个在 Unix 设计背后的最好观念. 大部分的编程问题其实可以划分为 2 部分: **"提供什么能力"(机制) 和 "如何使用这些能力"(策略).** 如果这两方面由程序的不同部分来表达, 或者甚至由不同的程序共同表达, 软件包是非常容易开发和适应特殊的需求.

* 驱动程序: “提供什么能力”
* 应用程序: “如果使用这些能力"

----

在编写驱动时, 程序员应当特别注意这个基础的概念: 编写内核代码来存取硬件, 但是不能强加特别的策略给用户（比如块设备的读写，不能要求用户每次都要读一个块，而是对上层用户察觉不到与字符设备的驱动，对下层自己实现任意字节的读写）, 因为不同的用户有不同的需求.   
**驱动应当做到使硬件可用, 将所有关于如何使用硬件的事情留给应用程序.**    
一个驱动, 这样, 就是灵活的, 如果它提供了对硬件能力的存取, 没有增加约束. 然而, 有时必须作出一些策略的决定. 例如, 一个数字 I/O 驱动也许只提供对硬件的字符存取, 以便避免额外的代码处理单个位.

----

Linux的一大优良特性就是可以在运行时扩展内核的功能（通过加载与卸载模块）。

内核模块是Linux内核向外部提供的一个插口，其全称为**动态可加载内核模块（Loadable Kernel Module，LKM），我们简称为模块**。   

Linux内核之所以提供模块机制，是因为它本身是一个**单内核（monolithic kernel）**。   

**单内核的最大优点是效率高，因为所有的内容都集成在一起，但其缺点是可扩展性和可维护性相对较差，模块机制就是为了弥补这一缺陷。**

模块是具有独立功能的程序，它可以被单独编译，但不能独立运行。它在运行时被链接到内核作为内核的一部分在内核空间运行，这与运行在用户空间的进程是不同的。模块通常由一组函数和数据结构组成，用来实现一种文件系统、一个驱动程序或其他内核上层的功能。  

